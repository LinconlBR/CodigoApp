import React from 'react';
import { Card } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Sparkles, TrendingDown, Droplets, Zap, Leaf, AlertCircle } from "lucide-react";

const transportImpact = {
  car_gasoline: { co2: "alto", label: "Carro (Gasolina)", color: "text-red-600" },
  car_electric: { co2: "baixo", label: "Carro El√©trico", color: "text-green-600" },
  car_hybrid: { co2: "m√©dio", label: "Carro H√≠brido", color: "text-yellow-600" },
  motorcycle: { co2: "m√©dio", label: "Moto", color: "text-yellow-600" },
  public_transport: { co2: "baixo", label: "Transporte P√∫blico", color: "text-green-600" },
  bicycle: { co2: "zero", label: "Bicicleta", color: "text-emerald-600" },
  walk: { co2: "zero", label: "A p√©", color: "text-emerald-600" },
  mixed: { co2: "m√©dio", label: "Misto", color: "text-yellow-600" }
};

export default function PersonalizedInsights({ user, stats }) {
  const getWaterInsight = () => {
    const perPerson = parseFloat(stats.waterPerPerson);
    const avgBrazilian = 150; // litros por dia por pessoa
    
    if (perPerson < avgBrazilian) {
      return {
        type: "success",
        icon: Droplets,
        title: "Consumo de √°gua abaixo da m√©dia!",
        message: `Voc√™ est√° consumindo ${perPerson} litros/dia por pessoa, abaixo da m√©dia brasileira de ${avgBrazilian}L. Parab√©ns!`,
        color: "text-emerald-600 bg-emerald-50"
      };
    }
    return {
      type: "warning",
      icon: Droplets,
      title: "Oportunidade de economia",
      message: `Consumo de ${perPerson}L/dia por pessoa. Tente banhos mais curtos e feche a torneira ao escovar os dentes.`,
      color: "text-blue-600 bg-blue-50"
    };
  };

  const getEnergyInsight = () => {
    if (user.has_solar_panels) {
      return {
        type: "success",
        icon: Zap,
        title: "Energia Solar Ativa! ‚òÄÔ∏è",
        message: "Sua energia solar est√° reduzindo sua pegada de carbono significativamente. Continue assim!",
        color: "text-yellow-600 bg-yellow-50"
      };
    }
    
    const perPerson = parseFloat(stats.energyPerPerson);
    const avgBrazilian = 100; // kWh por m√™s por pessoa
    
    if (perPerson > avgBrazilian) {
      return {
        type: "tip",
        icon: Zap,
        title: "Dica: Considere energia solar",
        message: `Seu consumo est√° acima da m√©dia. Pain√©is solares podem reduzir sua conta em at√© 95%!`,
        color: "text-amber-600 bg-amber-50"
      };
    }
    return null;
  };

  const getTransportInsight = () => {
    const transport = transportImpact[user.transportation_type];
    if (!transport) return null;

    if (transport.co2 === "alto") {
      return {
        type: "alert",
        icon: AlertCircle,
        title: "Alto impacto de transporte",
        message: `${transport.label} gera alta emiss√£o de CO‚ÇÇ. Considere carona solid√°ria ou transporte p√∫blico quando poss√≠vel.`,
        color: "text-red-600 bg-red-50"
      };
    } else if (transport.co2 === "zero") {
      return {
        type: "success",
        icon: Leaf,
        title: "Transporte sustent√°vel!",
        message: `${transport.label} - zero emiss√µes! Voc√™ est√° fazendo uma diferen√ßa incr√≠vel para o planeta.`,
        color: "text-emerald-600 bg-emerald-50"
      };
    }
    return null;
  };

  const getGardenInsight = () => {
    if (user.has_garden) {
      return {
        type: "success",
        icon: Leaf,
        title: "Jardim/Horta presente! üåø",
        message: "√ìtimo! Sua √°rea verde ajuda a capturar CO‚ÇÇ e pode fornecer alimentos frescos.",
        color: "text-green-600 bg-green-50"
      };
    }
    return null;
  };

  const insights = [
    getWaterInsight(),
    getEnergyInsight(),
    getTransportInsight(),
    getGardenInsight()
  ].filter(Boolean);

  return (
    <Card className="p-6 mb-6 border-0 bg-gradient-to-br from-emerald-500/5 via-teal-500/5 to-cyan-500/5 backdrop-blur-sm">
      <div className="flex items-center gap-3 mb-4">
        <Sparkles className="w-5 h-5 text-emerald-600" />
        <h3 className="font-semibold text-gray-900 text-lg">Insights Personalizados</h3>
        <Badge variant="secondary" className="ml-auto bg-emerald-100 text-emerald-700">
          Para sua casa
        </Badge>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        {insights.map((insight, index) => {
          const Icon = insight.icon;
          return (
            <div
              key={index}
              className={`p-4 rounded-xl ${insight.color} border border-current/10`}
            >
              <div className="flex items-start gap-3">
                <Icon className="w-5 h-5 shrink-0 mt-0.5" />
                <div>
                  <p className="font-semibold mb-1">{insight.title}</p>
                  <p className="text-sm opacity-90">{insight.message}</p>
                </div>
              </div>
            </div>
          );
        })}
      </div>

      <div className="mt-4 pt-4 border-t border-gray-200">
        <div className="flex items-center justify-between text-sm">
          <span className="text-gray-600">
            üè† Resid√™ncia {user.residence_size === 'small' ? 'Pequena' : user.residence_size === 'medium' ? 'M√©dia' : 'Grande'}
          </span>
          <span className="text-gray-600">
            ‚ôªÔ∏è Recicla: {user.recycling_habit === 'always' ? 'Sempre' : user.recycling_habit === 'sometimes' ? '√Äs vezes' : user.recycling_habit === 'rarely' ? 'Raramente' : 'Nunca'}
          </span>
        </div>
      </div>
    </Card>
  );
}